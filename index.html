<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OIIA OIIA CAT ğŸ±</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ±</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: white;
            font-family: Arial, sans-serif;
            text-align: center;
            color: black;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            user-select: none;
        }

        .title {
            font-size: 48px;
            font-weight: bold;
            margin: 20px 0;
            color: black;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .score {
            font-size: 32px;
            margin: 20px 0;
            color: #333;
            font-weight: bold;
        }

        .connection-status {
            padding: 8px 16px;
            margin: 10px 0;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .cat-container {
            margin: 30px 0;
            cursor: pointer;
            transition: transform 0.1s;
        }
        
        .cat-container:hover {
            transform: scale(1.05);
        }

        .cat-container:active {
            transform: scale(0.95);
        }

        .cat-image {
            width: 400px;
            height: 400px;
            border-radius: 50%;
            object-fit: cover;
            border: 5px solid #ddd;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .ranking {
            margin: 30px auto;
            padding: 20px;
            border: 2px solid #ddd;
            border-radius: 15px;
            max-width: 500px;
            background: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .ranking h3 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 24px;
        }
        
        .total-clicks {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .country-item {
            margin: 8px 0;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
        }

        .instructions {
            margin-top: 20px;
            font-size: 14px;
            color: #666;
        }

        .spinning {
            animation: spin 0.5s ease-in-out;
        }

        @keyframes spin {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.1); }
            100% { transform: rotate(360deg) scale(1); }
        }
    </style>
</head>
<body>
    <div class="title">OIIA OIIA CAT</div>
    <div class="score" id="personalScore">ê°œì¸ ì ìˆ˜: 0</div>
    <div class="connection-status" id="connectionStatus">ğŸŸ¢ ì„œë²„ë¦¬ìŠ¤ API ì—°ê²°ë¨</div>
    
    <div class="cat-container" id="catContainer">
        <img class="cat-image" id="catImage" src="/cat-static.gif" alt="ê³ ì–‘ì´" draggable="false">
    </div>

    <div class="ranking">
        <h3>ğŸŒ ì‹¤ì‹œê°„ ì „ì„¸ê³„ ë­í‚¹</h3>
        <div class="total-clicks" id="totalClicks">ì´ í´ë¦­ìˆ˜: ë¡œë”© ì¤‘...</div>
        <div id="countryRanking">ë­í‚¹ ë¡œë”© ì¤‘...</div>
    </div>

    <div class="instructions">
        ğŸ–±ï¸ ë§ˆìš°ìŠ¤ë¡œ í´ë¦­í•˜ê±°ë‚˜ ìŠ¤í˜ì´ìŠ¤ë°”ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”!<br>
        ğŸŒ ì‹¤ì‹œê°„ ì„œë²„ë¦¬ìŠ¤ API ê¸°ë°˜ ë­í‚¹ ì‹œìŠ¤í…œ ğŸ”¥
    </div>

    <audio id="clickSound" preload="auto" loop>
        <source src="/spin.mp3" type="audio/mpeg">
    </audio>

    <script>
        console.log('ğŸ± OIIA OIIA CAT - ì„œë²„ë¦¬ìŠ¤ API ë­í‚¹ ì‹œìŠ¤í…œ v6.0');
        console.log('âš¡ Vercel Serverless Functions');
        console.log('ğŸ”¥ ì‹¤ì‹œê°„ API ê¸°ë°˜ ë­í‚¹ ì‹œìŠ¤í…œ');
        
        // ì „ì—­ ë³€ìˆ˜
        let personalScore = parseInt(localStorage.getItem('oiia_personal_score') || '0');
        let isClicking = false;
        
        // DOM ìš”ì†Œ
        const scoreEl = document.getElementById('personalScore');
        const catImage = document.getElementById('catImage');
        const catContainer = document.getElementById('catContainer');
        const clickSound = document.getElementById('clickSound');
        const totalClicksEl = document.getElementById('totalClicks');
        const countryRankingEl = document.getElementById('countryRanking');
        const connectionStatusEl = document.getElementById('connectionStatus');
        
        // ì´ˆê¸° ì„¤ì •
        scoreEl.textContent = `ê°œì¸ ì ìˆ˜: ${personalScore.toLocaleString()}`;
        clickSound.volume = 0.5;

        // API í˜¸ì¶œ í•¨ìˆ˜
        async function callAPI(endpoint, method = 'GET', data = null) {
            try {
                const options = {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                    }
                };
                
                if (data) {
                    options.body = JSON.stringify(data);
                }
                
                const response = await fetch(`/api/${endpoint}`, options);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error(`âŒ API í˜¸ì¶œ ì‹¤íŒ¨ (${endpoint}):`, error);
                return null;
            }
        }

        // ë­í‚¹ ë¡œë“œ í•¨ìˆ˜
        async function loadRanking() {
            try {
                const data = await callAPI('ranking');
                if (data) {
                    updateRankingDisplay(data);
                }
            } catch (error) {
                console.error('âŒ ë­í‚¹ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // í´ë¦­ ì „ì†¡ í•¨ìˆ˜
        async function sendClick() {
            try {
                const data = await callAPI('click', 'POST', {
                    timestamp: new Date().toISOString()
                });
                
                if (data && data.success) {
                    console.log(`ğŸ–±ï¸ í´ë¦­ ì „ì†¡ ì„±ê³µ: ${data.countryCode}`);
                    // í´ë¦­ í›„ ë­í‚¹ ìƒˆë¡œê³ ì¹¨
                    setTimeout(loadRanking, 500);
                }
            } catch (error) {
                console.error('âŒ í´ë¦­ ì „ì†¡ ì‹¤íŒ¨:', error);
            }
        }

        // ë­í‚¹ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateRankingDisplay(data) {
            console.log('ğŸ“Š ë­í‚¹ ì—…ë°ì´íŠ¸:', data);
            
            // ì´ í´ë¦­ìˆ˜ ì—…ë°ì´íŠ¸
            totalClicksEl.textContent = `ì´ í´ë¦­ìˆ˜: ${data.totalClicks.toLocaleString()}`;
            
            // êµ­ê°€ë³„ ë­í‚¹ í‘œì‹œ
            if (data.countries && data.countries.length > 0) {
                const rankingHtml = data.countries
                    .slice(0, 10) // ìƒìœ„ 10ê°œêµ­ë§Œ í‘œì‹œ
                    .map((country, index) => 
                        `<div class="country-item">${country.flag} ${index + 1}. ${country.name}: ${country.clicks.toLocaleString()}</div>`
                    ).join('');
                
                countryRankingEl.innerHTML = rankingHtml;
            } else {
                countryRankingEl.innerHTML = '<div class="country-item">ë­í‚¹ ë¡œë”© ì¤‘...</div>';
            }
        }

        // ê³ ì–‘ì´ í´ë¦­ ì²˜ë¦¬
        function handleClick() {
            if (isClicking) return;
            
            // ê°œì¸ ì ìˆ˜ ì¦ê°€
            personalScore++;
            scoreEl.textContent = `ê°œì¸ ì ìˆ˜: ${personalScore.toLocaleString()}`;
            localStorage.setItem('oiia_personal_score', personalScore.toString());
            
            // ì„œë²„ì— í´ë¦­ ì „ì†¡
            sendClick();
            
            // ì‹œê°ì  íš¨ê³¼
            performClickAnimation();
            
            // ì‚¬ìš´ë“œ ì¬ìƒ
            startSound();
            
            isClicking = true;
            setTimeout(() => {
                isClicking = false;
            }, 100);
        }

        // í´ë¦­ ì• ë‹ˆë©”ì´ì…˜
        function performClickAnimation() {
            // ê³ ì–‘ì´ ì´ë¯¸ì§€ ë³€ê²½
            catImage.src = '/cat-spin.gif';
            catContainer.classList.add('spinning');
            
            setTimeout(() => {
                catImage.src = '/cat-static.gif';
                catContainer.classList.remove('spinning');
            }, 500);
        }

        // ì‚¬ìš´ë“œ ì¬ìƒ
        function startSound() {
            try {
                clickSound.currentTime = 0;
                const playPromise = clickSound.play();
                if (playPromise !== undefined) {
                    playPromise.catch(e => console.log('ì‚¬ìš´ë“œ ì¬ìƒ ì‹¤íŒ¨:', e.message));
                }
            } catch (error) {
                console.log('ì‚¬ìš´ë“œ ì¬ìƒ ì˜¤ë¥˜:', error.message);
            }
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        catContainer.addEventListener('click', handleClick);
        
        catContainer.addEventListener('mousedown', () => {
            catContainer.style.transform = 'scale(0.95)';
        });
        
        catContainer.addEventListener('mouseup', () => {
            catContainer.style.transform = 'scale(1)';
        });
        
        catContainer.addEventListener('mouseleave', () => {
            catContainer.style.transform = 'scale(1)';
        });

        // í‚¤ë³´ë“œ ì´ë²¤íŠ¸
        document.addEventListener('keydown', (event) => {
            if (event.code === 'Space') {
                event.preventDefault();
                handleClick();
            }
        });

        // í˜ì´ì§€ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸš€ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
            loadRanking();
            
            // 3ì´ˆë§ˆë‹¤ ë­í‚¹ ìë™ ìƒˆë¡œê³ ì¹¨
            setInterval(loadRanking, 3000);
        });

        // ì¦‰ì‹œ ë­í‚¹ ë¡œë“œ
        loadRanking();
    </script>
</body>
</html> 